## REST contract

Gateway request (JSON):

```json
{
  "referenceId": "string",
  "to": "string",
  "message": "string",
  "tenantId": "string (optional)"
}
````

Gateway response (JSON):

```json
{
  "referenceId": "string",
  "status": "accepted|rejected",
  "gatewayMessageId": "string (present when accepted)",
  "reason": "invalid_request|duplicate_reference|invalid_recipient|invalid_message|provider_failure (present when rejected)"
}
```

## HTTP status semantics

400
The request is invalid or a duplicate.
The client must change the request before retrying.

200 + status=rejected
Submission was attempted but not confirmed.
The client may retry later with the same or a new referenceId, based on its own policy.

200 + status=accepted
The request was successfully submitted to the provider.

## Submission vs delivery

An accepted response means the request was successfully submitted to the provider.

It does not guarantee:

* message delivery
* eventual delivery status
* retries on failure
* reconciliation

Delivery outcomes, if required, must be handled by systems outside the gateway.

## gatewayMessageId semantics

gatewayMessageId is generated by the gateway and is present only when status=accepted.
It represents confirmed submission, not delivery.
It must not be assumed to exist:
* when submission outcome is ambiguous
* when the provider fails or times out

## Idempotency

Gateway prevents concurrent duplicate submissions within a single process using referenceId.
It does not provide durable or cross-process idempotency, so a duplicate after a request completes may be accepted.

## Troubleshooting

Gateway troubleshooting is log-based.
Submission behavior can be reconstructed using the client-supplied referenceId.

## Local fake provider + gateway smoke test

Start the fake provider:

```sh
go run ./cmd/fakeprovider -addr :9090
```

Gateway loads its configuration from `config.json` in the working directory:

```json
{
  "addr": ":8080",
  "smsProviderUrl": "http://localhost:9090/sms/send",
  "smsProviderTimeoutSeconds": 30
}
```

Start the gateway:

```sh
go run ./cmd/gateway
```

Send requests through the gateway (use a fresh referenceId each time):

```sh
curl -i -X POST http://localhost:8080/sms/send \
  -H 'Content-Type: application/json' \
  -d '{"referenceId":"ref-1","to":"15551234567","message":"hello"}'

curl -i -X POST http://localhost:8080/sms/send \
  -H 'Content-Type: application/json' \
  -d '{"referenceId":"ref-2","to":"abc","message":"hello"}'

curl -i -X POST http://localhost:8080/sms/send \
  -H 'Content-Type: application/json' \
  -d '{"referenceId":"ref-3","to":"15551234567","message":"                     "}'

curl -i -X POST http://localhost:8080/sms/send \
  -H 'Content-Type: application/json' \
  -d '{"referenceId":"ref-4FAIL","to":"15551234567","message":"hello"}'
```

Final note
Gateway is a real-time submission bridge.
It guarantees truthful submission outcomes and nothing beyond that.
Any capability beyond submission (delivery tracking, retries, reconciliation)
requires a separate system with explicit time ownership.

```

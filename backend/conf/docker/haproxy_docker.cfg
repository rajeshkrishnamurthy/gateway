global
  daemon
  maxconn 2048
  log stdout format raw local0 err

defaults
  mode http
  log global
  option httplog
  timeout connect 5s
  timeout client 30s
  timeout server 30s

frontend sms_gateway
  bind *:8080
  http-request return status 200 if { path /readyz }
  default_backend sms_backends

backend sms_backends
  balance roundrobin
  option httpchk GET /metrics
  server sms1 sms-gateway-1:8080 check
  server sms2 sms-gateway-2:8080 check

frontend push_gateway
  bind *:8081
  http-request return status 200 if { path /readyz }
  default_backend push_backends

backend push_backends
  balance roundrobin
  option httpchk GET /metrics
  server push1 push-gateway-1:8081 check
  server push2 push-gateway-2:8081 check

frontend submission_manager
  bind *:8082
  http-request return status 200 if { path /readyz }
  default_backend submission_manager_backends

backend submission_manager_backends
  balance roundrobin
  option httpchk GET /readyz
  server sm1 submission-manager-1:8082 check
  server sm2 submission-manager-2:8082 check

listen haproxy_stats
  bind *:8404
  stats enable
  stats uri /stats
  stats refresh 5s
